<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>[Android] Change locale, default locale, language list | 摸摸嚕嚕</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="在andoird 手機 ODM&#x2F;OEM公司中.常常要配合客戶的SPEC修改預設的語系.還有語言列表. 以及隨著特殊的SPEC修改目前的語系等等會逐一分享. Change Locale 更換語系先從基本的更換語系開始 changelocale1234567891011121314151617181920import android.app.ActivityManagerNative;imp">
<meta property="og:type" content="article">
<meta property="og:title" content="[Android] Change locale, default locale, language list">
<meta property="og:url" content="https://alumincan.github.io/2014/10/21/2014-10-21-android-locale/index.html">
<meta property="og:site_name" content="摸摸嚕嚕">
<meta property="og:description" content="在andoird 手機 ODM&#x2F;OEM公司中.常常要配合客戶的SPEC修改預設的語系.還有語言列表. 以及隨著特殊的SPEC修改目前的語系等等會逐一分享. Change Locale 更換語系先從基本的更換語系開始 changelocale1234567891011121314151617181920import android.app.ActivityManagerNative;imp">
<meta property="og:locale" content="zh_TW">
<meta property="article:published_time" content="2014-10-21T14:33:00.000Z">
<meta property="article:modified_time" content="2023-04-26T05:05:54.996Z">
<meta property="article:author" content="Alucard">
<meta property="article:tag" content="Locales">
<meta property="article:tag" content="Language lise">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="摸摸嚕嚕" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">摸摸嚕嚕</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">從 Hello World 開始</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Suche"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Suche"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://alumincan.github.io"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-2014-10-21-android-locale" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2014/10/21/2014-10-21-android-locale/" class="article-date">
  <time class="dt-published" datetime="2014-10-21T14:33:00.000Z" itemprop="datePublished">2014-10-21</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Android/">Android</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      [Android] Change locale, default locale, language list
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>在andoird 手機 ODM&#x2F;OEM公司中.<br>常常要配合客戶的SPEC修改預設的語系.還有語言列表. 以及隨著特殊的SPEC修改目前的語系等等<br>會逐一分享.</p>
<h2 id="Change-Locale-更換語系"><a href="#Change-Locale-更換語系" class="headerlink" title="Change Locale 更換語系"></a>Change Locale 更換語系</h2><p>先從基本的更換語系開始</p>
<figure class="highlight java"><figcaption><span>changelocale</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> android.app.ActivityManagerNative;</span><br><span class="line"><span class="keyword">import</span> android.app.IActivityManager;</span><br><span class="line"><span class="keyword">import</span> java.util.Locale;</span><br><span class="line"><span class="keyword">import</span> android.content.res.Configuration;</span><br><span class="line"><span class="keyword">import</span> android.os.RemoteException;</span><br><span class="line">.........</span><br><span class="line">..........</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateLocale</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">Locale</span> <span class="variable">l</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Locale</span>(<span class="string">&quot;en&quot;</span>, <span class="string">&quot;US&quot;</span>); <span class="comment">//Locale(string_language, string_location)</span></span><br><span class="line">        <span class="type">IActivityManager</span> <span class="variable">am</span> <span class="operator">=</span> ActivityManagerNative.getDefault();</span><br><span class="line">        <span class="type">Configuration</span> <span class="variable">config</span> <span class="operator">=</span> am.getConfiguration();</span><br><span class="line">        config.setLocale(l);</span><br><span class="line">        am.updateConfiguration(config);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (RemoteException e) &#123;</span><br><span class="line">        Log.d(TAG, <span class="string">&quot;fail to update configuration&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>我記得要更換語系是需要system 權限的，所以別忘記在AndroidManifest.xml要加入 shareUserID&#x3D;system</p>
<figure class="highlight xml"><figcaption><span>AndroidManifest.xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">manifest</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">package</span>=<span class="string">&quot;com.android.settings&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">coreApp</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">android:sharedUserId</span>=<span class="string">&quot;android.uid.system&quot;</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="Language-List-語言列表"><a href="#Language-List-語言列表" class="headerlink" title="Language List 語言列表"></a>Language List 語言列表</h2><p>語言列表通常會在哪裡看到呢？<br>    1. OOBE<br>    2. Settings-&gt;Input method &amp; language</p>
<p>要討論語言列表有兩個角度可以探討:<br>    - 手機中所有的語言列表有多少？<br>    - Settings and OOBE 出現能選擇的語言有多少？</p>
<p><strong>qualcomm &#x2F;aosp</strong><br>可以在 <em>aosp&#x2F;build&#x2F;target&#x2F;product&#x2F;fullbase.mk</em> 發現</p>
<figure class="highlight makefile"><figcaption><span>build/target/product/fullbase.mk</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$(<span class="built_in">call</span> inherit-product, <span class="variable">$(SRC_TARGET_DIR)</span>/product/locales_full.mk)</span></span><br></pre></td></tr></table></figure>
<p>那麼！<em>aosp&#x2F;build&#x2F;target&#x2F;product&#x2F;locales_full.mk</em> 會看到</p>
<figure class="highlight makefile"><figcaption><span>aosp/build/target/product/locales_full.mk</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">PRODUCT_LOCALES := en_US en_IN fr_FR it_IT es_ES et_EE de_DE nl_NL cs_CZ pl_PL ja_JP zh_TW zh_CN zh_HK ru_RU ko_KR nb_NO es_US da_DK el_GR tr_TR pt_PT pt_BR rm_CH sv_SE bg_BG ca_ES en_GB fi_FI hi_IN hr_HR hu_HU in_ID iw_IL lt_LT lv_LV ro_RO sk_SK sl_SI sr_RS uk_UA vi_VN tl_PH ar_EG fa_IR th_TH sw_TZ ms_MY af_ZA zu_ZA am_ET hi_IN en_XA ar_XB fr_CA km_KH lo_LA ne_NP si_LK mn_MN hy_AM az_AZ ka_GE</span><br><span class="line">..........................</span><br><span class="line">..........................</span><br></pre></td></tr></table></figure>
<p>便可以在這邊新增&#x2F;刪除 客製化語言列表的功能.</p>
<p><strong>MTK platform</strong><br>其實大同小異，只是檔案名稱跟路徑不一樣</p>
<figure class="highlight makefile"><figcaption><span>Project/mediatek/config/projectname/ProjectConfig.mk</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PRODUCT_LOCALES := en_US en_IN fr_FR it_IT es_ES et_EE de_DE nl_NL cs_CZ pl_PL ja_JP zh_TW zh_CN zh_HK ru_RU ko_KR nb_NO es_US da_DK el_GR tr_TR pt_PT pt_BR rm_CH sv_SE bg_BG ca_ES en_GB fi_FI hi_IN hr_HR hu_HU in_ID iw_IL lt_LT lv_LV ro_RO sk_SK sl_SI sr_RS uk_UA vi_VN tl_PH ar_EG fa_IR th_TH sw_TZ ms_MY af_ZA zu_ZA am_ET hi_IN en_XA ar_XB fr_CA km_KH lo_LA ne_NP si_LK mn_MN hy_AM az_AZ ka_GE</span><br></pre></td></tr></table></figure>

<p>總是天不從人願，很多客戶很喜歡同個image有不一樣的設定.<br>ex: 隨著SIM卡不同？或是隨著operator變化？</p>
<p>首先，還是得先完成上面的工作。把所有可能會用到的語言添加進mk檔. (看是哪種platform)<br>再來。請看到 “<em>frameworks&#x2F;base&#x2F;core&#x2F;java&#x2F;com&#x2F;android&#x2F;internal&#x2F;app&#x2F;LocalePicker.java</em>“</p>
<figure class="highlight java"><figcaption><span>LocalePicker.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> ArrayAdapter&lt;LocaleInfo&gt; <span class="title function_">constructAdapter</span><span class="params">(Context context,</span></span><br><span class="line"><span class="params">            <span class="keyword">final</span> <span class="type">int</span> layoutId, <span class="keyword">final</span> <span class="type">int</span> fieldId, <span class="keyword">final</span> <span class="type">boolean</span> isInDeveloperMode)</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">Resources</span> <span class="variable">resources</span> <span class="operator">=</span> context.getResources();</span><br><span class="line"></span><br><span class="line">        ArrayList&lt;String&gt; localeList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;(Arrays.asList(</span><br><span class="line">                Resources.getSystem().getAssets().getLocales())); <span class="comment">//取得系統目前的所有語言列表</span></span><br><span class="line">        <span class="keyword">if</span> (isInDeveloperMode) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!localeList.contains(<span class="string">&quot;zz_ZZ&quot;</span>)) &#123;</span><br><span class="line">                localeList.add(<span class="string">&quot;zz_ZZ&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="comment">/** - <span class="doctag">TODO:</span> Enable when zz_ZY Pseudolocale is complete</span></span><br><span class="line"><span class="comment">         *  if (!localeList.contains(&quot;zz_ZY&quot;)) &#123;</span></span><br><span class="line"><span class="comment">         *      localeList.add(&quot;zz_ZY&quot;);</span></span><br><span class="line"><span class="comment">         *      &#125;</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        &#125;</span><br><span class="line">        String[] locales = <span class="keyword">new</span> <span class="title class_">String</span>[localeList.size()];</span><br><span class="line">        locales = localeList.toArray(locales);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> String[] specialLocaleCodes = resources.getStringArray(R.array.special_locale_codes);</span><br><span class="line">        <span class="keyword">final</span> String[] specialLocaleNames = resources.getStringArray(R.array.special_locale_names);</span><br><span class="line">        Arrays.sort(locales); <span class="comment">//排序語言列表</span></span><br><span class="line">        ...................................................................</span><br><span class="line">        ...................................................................</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>那其實最關鍵的地方就在於 </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">String[] locales = <span class="keyword">new</span> <span class="title class_">String</span>[localeList.size()];</span><br><span class="line">locales = localeList.toArray(locales); </span><br></pre></td></tr></table></figure>
<p>只要讓locales裝上客製化的語言列表即可.<br>ex:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">_locale</span> <span class="operator">=</span> <span class="string">&quot;en_US,zh_TW&quot;</span>;</span><br><span class="line">String locales[] = _locale.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">Arrays.sort(locales);</span><br></pre></td></tr></table></figure>

<h2 id="Default-Locale-預設語系"><a href="#Default-Locale-預設語系" class="headerlink" title="Default Locale 預設語系"></a>Default Locale 預設語系</h2><p>因應會有各客戶或是operator希望出貨時第一次開機的語系能跟出貨地區配合<br>所以有研究這個機制 (其實也沒什麼好研究的 囧)</p>
<p>首先先看會決定語系的幾個property</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">persist.sys.language=zh</span><br><span class="line">persist.sys.region=TW</span><br><span class="line">ro.product.locale.language=en</span><br><span class="line">ro.product.locale.country=US</span><br></pre></td></tr></table></figure>
<p>Locale &#x3D; language_country(or region)<br>Android 系統會優先以 persist 開頭的property作為目前系統的語系<br>如上面的例子：目前系統的顯示語言應為 繁體中文 (zh_TW)</p>
<ol>
<li><p>所以可以在 project&#x2F;build&#x2F;core&#x2F;Makefile 中修改, 加入persist或是在init.rc跟system.prop 加上都可以	<br><strong>Ex: Qualcomm platform</strong></p>
<figure class="highlight makefile"><figcaption><span>device/qcom/msmXXXX/system.prop</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">persist.sys.language=zh</span><br><span class="line">persist.sys.region=TW</span><br></pre></td></tr></table></figure>
</li>
<li><p>Android系統有個機制，在persist.sys.laguage跟persist.sys.region沒有value時：<strong>系統會把SIM的語系資料套用到整個系統</strong>.<br>Ex: 再第一次開機或是Factory reset後. 手機已經插入Orange的SIM卡，開機的預設語言變化設成 <strong>fr_FR</strong>. 	<br>所以按照第一點的方式去預設語系，則此功能將不會有作用 &#x3D; issue. (其實是看客戶啦.)	<br>那麼，就改設ro.product.locale.language跟ro.product.locale.country.	<br>範例其實跟第一點一樣，只是改成ro開頭的prop<br><strong>Ex: Qualcomm platform</strong></p>
<figure class="highlight makefile"><figcaption><span>device/qcom/msmXXXX/system.prop</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ro.product.locale.language=zh</span><br><span class="line">ro.product.locale.country=TW</span><br></pre></td></tr></table></figure>
<p>如果是有更複雜的需求，如開機後才判斷預設語系要設成那一組<br>上面的方法可能比較不彈性。<br>我個人的經驗，曾經在幾個地方設置過機制<br>首先. 把下面這段code拿掉 or 註解， 如此就不會有ro跟persist開頭的語系properties生成</p>
<figure class="highlight sh"><figcaption><span>build/tools/buildinfo.sh</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">..............................</span><br><span class="line">..............................</span><br><span class="line"><span class="comment">#echo &quot;ro.product.manufacturer=$PRODUCT_MANUFACTURER&quot;</span></span><br><span class="line"><span class="keyword">if</span> [ -n <span class="string">&quot;<span class="variable">$PRODUCT_DEFAULT_LANGUAGE</span>&quot;</span> ] ; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;ro.product.locale.language=<span class="variable">$PRODUCT_DEFAULT_LANGUAGE</span>&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">if</span> [ -n <span class="string">&quot;<span class="variable">$PRODUCT_DEFAULT_REGION</span>&quot;</span> ] ; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;ro.product.locale.region=<span class="variable">$PRODUCT_DEFAULT_REGION</span>&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">.....................................</span><br><span class="line">.....................................</span><br></pre></td></tr></table></figure>
<ul>
<li>在 依照需求建立不同的.prop檔. 然後在system&#x2F;core&#x2F;init&#x2F;property_service.c中load.</li>
</ul>
</li>
</ol>
<ul>
<li>或是在 system&#x2F;core&#x2F;init&#x2F;init.c 中設定</li>
<li>最後就是在 frameworks&#x2F;base&#x2F;core&#x2F;jni&#x2F;AndroidRuntime.cpp 中設定</li>
</ul>
<figure class="highlight java"><figcaption><span>AndroidRuntime.cpp</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">readLocale</span><span class="params">(<span class="type">char</span>* language, <span class="type">char</span>* region)</span> &#123;</span><br><span class="line">    <span class="type">char</span> propLang[PROPERTY_VALUE_MAX], propRegn[PROPERTY_VALUE_MAX];</span><br><span class="line">    property_get(<span class="string">&quot;persist.sys.language&quot;</span>, propLang, <span class="string">&quot;&quot;</span>);</span><br><span class="line">    property_get(<span class="string">&quot;persist.sys.country&quot;</span>, propRegn, <span class="string">&quot;&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (*propLang == <span class="number">0</span> &amp;&amp; *propRegn == <span class="number">0</span>) &#123;<span class="comment">//在persist.sys.language跟persist.sys.country為空時進入</span></span><br><span class="line">        <span class="comment">/* Set to ro properties, default is en_US */</span></span><br><span class="line">        <span class="comment">/* 可以將下列的 en 與 US 替換成所需要的locale */</span></span><br><span class="line">        property_get(<span class="string">&quot;ro.product.locale.language&quot;</span>, propLang, <span class="string">&quot;en&quot;</span>);</span><br><span class="line">        property_get(<span class="string">&quot;ro.product.locale.region&quot;</span>, propRegn, <span class="string">&quot;US&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    strncat(language, propLang, <span class="number">2</span>);</span><br><span class="line">    strncat(region, propRegn, <span class="number">2</span>);</span><br><span class="line">    <span class="comment">//ALOGD(&quot;language=%s region=%s\n&quot;, language, region);</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<hr>
<p>Update at 2016: Android M</p>
<p>遇到issue了,  回過頭看一下發現在Android M的機制似乎有更改：</p>
<p>property:<br>新增了兩組：<code>ro.product.locale</code> 與 <code>persist.sys.locale</code></p>
<figure class="highlight sh"><figcaption><span>build/tools/buildinfo.sh</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">..............................</span><br><span class="line">..............................</span><br><span class="line"><span class="comment">#echo &quot;ro.product.manufacturer=$PRODUCT_MANUFACTURER&quot;</span></span><br><span class="line"><span class="keyword">if</span> [ -n <span class="string">&quot;<span class="variable">$PRODUCT_DEFAULT_LANGUAGE</span>&quot;</span> ] ; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;ro.product.locale.language=<span class="variable">$PRODUCT_DEFAULT_LANGUAGE</span>&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">if</span> [ -n <span class="string">&quot;<span class="variable">$PRODUCT_DEFAULT_REGION</span>&quot;</span> ] ; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;ro.product.locale.region=<span class="variable">$PRODUCT_DEFAULT_REGION</span>&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">.....................................</span><br><span class="line">.....................................</span><br></pre></td></tr></table></figure>
<p>上面這組sh 被替換成：</p>
<figure class="highlight sh"><figcaption><span>build/tools/buildinfo.sh</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">..............................</span><br><span class="line">..............................</span><br><span class="line"><span class="comment">#echo &quot;ro.product.manufacturer=$PRODUCT_MANUFACTURER&quot;</span></span><br><span class="line"><span class="keyword">if</span> [ -n <span class="string">&quot;<span class="variable">$PRODUCT_DEFAULT_LOCALE</span>&quot;</span> ] ; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;ro.product.locale=<span class="variable">$PRODUCT_DEFAULT_LOCALES</span>&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">.....................................</span><br><span class="line">.....................................</span><br></pre></td></tr></table></figure>
<p>ro.product.locale.language與ro.product.locale.region 已經在此檔案中移除</p>
<p>在AndroidRuntime.cpp 在readlocale() 中的機制也有所更改</p>
<figure class="highlight cpp"><figcaption><span>AndroidRuntime.cpp</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">const</span> std::string <span class="title">readLocale</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">const</span> std::string locale = <span class="built_in">getProperty</span>(<span class="string">&quot;persist.sys.locale&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (!locale.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">        <span class="keyword">return</span> locale;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">const</span> std::string language = <span class="built_in">getProperty</span>(<span class="string">&quot;persist.sys.language&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (!language.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">        <span class="type">const</span> std::string country = <span class="built_in">getProperty</span>(<span class="string">&quot;persist.sys.country&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="type">const</span> std::string variant = <span class="built_in">getProperty</span>(<span class="string">&quot;persist.sys.localevar&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line">        std::string out = language;</span><br><span class="line">        <span class="keyword">if</span> (!country.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            out = out + <span class="string">&quot;-&quot;</span> + country;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!variant.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            out = out + <span class="string">&quot;-&quot;</span> + variant;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> out;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">const</span> std::string productLocale = <span class="built_in">getProperty</span>(<span class="string">&quot;ro.product.locale&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (!productLocale.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">        <span class="keyword">return</span> productLocale;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// If persist.sys.locale and ro.product.locale are missing,</span></span><br><span class="line">    <span class="comment">// construct a locale value from the individual locale components.</span></span><br><span class="line">    <span class="type">const</span> std::string productLanguage = <span class="built_in">getProperty</span>(<span class="string">&quot;ro.product.locale.language&quot;</span>, <span class="string">&quot;en&quot;</span>);</span><br><span class="line">    <span class="type">const</span> std::string productRegion = <span class="built_in">getProperty</span>(<span class="string">&quot;ro.product.locale.region&quot;</span>, <span class="string">&quot;US&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> productLanguage + <span class="string">&quot;-&quot;</span> + productRegion;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<pre><code>- 先確認 persist.sys.locale這個property是否存在？ return persist.sys.locale : next step
- 確認 persist.sys.locale.language/region存在？ return persist.sys.locale.language + region : next step
- 確認ro.product.locale是否存在？ return ro.product.locale : next step
- 確認ro.product.locale.language/region 存在？ return ro.product.locale.language + region : return en_US
</code></pre>
<p>以上是Android M的更新</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://alumincan.github.io/2014/10/21/2014-10-21-android-locale/" data-id="clgx8o85d0004mvjr9ay712xn" data-title="[Android] Change locale, default locale, language list" class="article-share-link">Teilen</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Language-lise/" rel="tag">Language lise</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Locales/" rel="tag">Locales</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2014/12/05/2014-12-05-android-icu4c/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Neuer</strong>
      <div class="article-nav-title">
        
          [Android] icu4c
        
      </div>
    </a>
  
  
    <a href="/2014/10/06/2014-10-06-android-enable-disable-activity/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Älter</strong>
      <div class="article-nav-title">[Android] enable / disable activity</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Kategorien</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Adndroid/">Adndroid</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">Android</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Blog/">Blog</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Docker/">Docker</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/OpenNI/">OpenNI</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Activity/" rel="tag">Activity</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android-M/" rel="tag">Android M</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android-open-source-project/" rel="tag">Android open source project</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android-studio/" rel="tag">Android studio</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android-%E7%B6%A0%E8%B1%86%E6%B9%AF/" rel="tag">Android 綠豆湯</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Associate-Android-Developer/" rel="tag">Associate Android Developer</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/AudioService/" rel="tag">AudioService</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Broadcast-receiver/" rel="tag">Broadcast receiver</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Build/" rel="tag">Build</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Camera/" rel="tag">Camera</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Cursor/" rel="tag">Cursor</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Drag-and-drop/" rel="tag">Drag and drop</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Eclipse/" rel="tag">Eclipse</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/EditText/" rel="tag">EditText</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Emulator/" rel="tag">Emulator</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Facebook/" rel="tag">Facebook</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Genymotion/" rel="tag">Genymotion</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hexo/" rel="tag">Hexo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Http-methods/" rel="tag">Http methods</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/IDE/" rel="tag">IDE</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Intent/" rel="tag">Intent</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Issue-analysis/" rel="tag">Issue analysis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Language-lise/" rel="tag">Language lise</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ListView/" rel="tag">ListView</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Locales/" rel="tag">Locales</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mac/" rel="tag">Mac</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OpenNI/" rel="tag">OpenNI</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PackageManager/" rel="tag">PackageManager</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SQLite/" rel="tag">SQLite</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SQLiteOpenHelper/" rel="tag">SQLiteOpenHelper</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Sieera/" rel="tag">Sieera</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Single-line/" rel="tag">Single line</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/StickyIntent/" rel="tag">StickyIntent</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/UI/" rel="tag">UI</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/UI-testing/" rel="tag">UI testing</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/UiAutomator/" rel="tag">UiAutomator</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/bash-profile/" rel="tag">bash_profile</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/bash-rc/" rel="tag">bash_rc</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker-import/" rel="tag">docker import</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker-load/" rel="tag">docker load</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker-run/" rel="tag">docker run</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/get/" rel="tag">get</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/github/" rel="tag">github</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/icu4c/" rel="tag">icu4c</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/json/" rel="tag">json</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/markdown/" rel="tag">markdown</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/permission/" rel="tag">permission</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/post/" rel="tag">post</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/stetho/" rel="tag">stetho</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Activity/" style="font-size: 10px;">Activity</a> <a href="/tags/Android-M/" style="font-size: 10px;">Android M</a> <a href="/tags/Android-open-source-project/" style="font-size: 15px;">Android open source project</a> <a href="/tags/Android-studio/" style="font-size: 20px;">Android studio</a> <a href="/tags/Android-%E7%B6%A0%E8%B1%86%E6%B9%AF/" style="font-size: 10px;">Android 綠豆湯</a> <a href="/tags/Associate-Android-Developer/" style="font-size: 10px;">Associate Android Developer</a> <a href="/tags/AudioService/" style="font-size: 10px;">AudioService</a> <a href="/tags/Broadcast-receiver/" style="font-size: 10px;">Broadcast receiver</a> <a href="/tags/Build/" style="font-size: 10px;">Build</a> <a href="/tags/Camera/" style="font-size: 10px;">Camera</a> <a href="/tags/Cursor/" style="font-size: 10px;">Cursor</a> <a href="/tags/Drag-and-drop/" style="font-size: 10px;">Drag and drop</a> <a href="/tags/Eclipse/" style="font-size: 10px;">Eclipse</a> <a href="/tags/EditText/" style="font-size: 10px;">EditText</a> <a href="/tags/Emulator/" style="font-size: 10px;">Emulator</a> <a href="/tags/Facebook/" style="font-size: 10px;">Facebook</a> <a href="/tags/Genymotion/" style="font-size: 10px;">Genymotion</a> <a href="/tags/Hexo/" style="font-size: 10px;">Hexo</a> <a href="/tags/Http-methods/" style="font-size: 10px;">Http methods</a> <a href="/tags/IDE/" style="font-size: 10px;">IDE</a> <a href="/tags/Intent/" style="font-size: 15px;">Intent</a> <a href="/tags/Issue-analysis/" style="font-size: 10px;">Issue analysis</a> <a href="/tags/Language-lise/" style="font-size: 10px;">Language lise</a> <a href="/tags/ListView/" style="font-size: 10px;">ListView</a> <a href="/tags/Locales/" style="font-size: 15px;">Locales</a> <a href="/tags/Mac/" style="font-size: 10px;">Mac</a> <a href="/tags/OpenNI/" style="font-size: 10px;">OpenNI</a> <a href="/tags/PackageManager/" style="font-size: 10px;">PackageManager</a> <a href="/tags/SQLite/" style="font-size: 10px;">SQLite</a> <a href="/tags/SQLiteOpenHelper/" style="font-size: 10px;">SQLiteOpenHelper</a> <a href="/tags/Sieera/" style="font-size: 10px;">Sieera</a> <a href="/tags/Single-line/" style="font-size: 10px;">Single line</a> <a href="/tags/StickyIntent/" style="font-size: 10px;">StickyIntent</a> <a href="/tags/UI/" style="font-size: 10px;">UI</a> <a href="/tags/UI-testing/" style="font-size: 10px;">UI testing</a> <a href="/tags/UiAutomator/" style="font-size: 10px;">UiAutomator</a> <a href="/tags/bash-profile/" style="font-size: 10px;">bash_profile</a> <a href="/tags/bash-rc/" style="font-size: 10px;">bash_rc</a> <a href="/tags/docker-import/" style="font-size: 10px;">docker import</a> <a href="/tags/docker-load/" style="font-size: 10px;">docker load</a> <a href="/tags/docker-run/" style="font-size: 10px;">docker run</a> <a href="/tags/get/" style="font-size: 10px;">get</a> <a href="/tags/github/" style="font-size: 10px;">github</a> <a href="/tags/icu4c/" style="font-size: 10px;">icu4c</a> <a href="/tags/json/" style="font-size: 10px;">json</a> <a href="/tags/markdown/" style="font-size: 10px;">markdown</a> <a href="/tags/permission/" style="font-size: 10px;">permission</a> <a href="/tags/post/" style="font-size: 10px;">post</a> <a href="/tags/stetho/" style="font-size: 10px;">stetho</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archiv</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/04/">四月 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">十月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">三月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">二月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">一月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">四月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">十一月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/09/">九月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/06/">六月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/04/">四月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/03/">三月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/01/">一月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/12/">十二月 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/10/">十月 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/09/">九月 2014</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">letzter Beitrag</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2023/04/26/hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="/2017/10/05/build-openNI1-5-on-Mac/">Build OpenNI1.5 on Mac</a>
          </li>
        
          <li>
            <a href="/2017/03/28/setup-blog-on-github/">使用 Hexo + github 建立Blog</a>
          </li>
        
          <li>
            <a href="/2017/03/28/Docker/">一些使用 Docker 的紀錄</a>
          </li>
        
          <li>
            <a href="/2017/03/22/dx-unsupported-class/">dx unsupported class file version 52.0</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2023 Alucard<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>